
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>B re issuance and batch issuance of pids and attestations - European Digital Identity</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#b-re-issuance-and-batch-issuance-of-pids-and-attestations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="European Digital Identity" class="md-header__button md-logo" aria-label="European Digital Identity" data-md-component="logo">
      
  <img src="../../media/eu-logo.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            European Digital Identity
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              B re issuance and batch issuance of pids and attestations
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/eu-digital-identity-wallet/eudi-doc-architecture-and-reference-framework" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    eu-digital-identity-wallet/eudi-doc-architecture-and-reference-framework
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  European Digital Identity Wallet

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../architecture-and-reference-framework-main/" class="md-tabs__link">
        
  
    
  
  Architecture and reference framework

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link">
        
  
    
  
  Discussion topics

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../technical-specifications/" class="md-tabs__link">
        
  
    
  
  Technical specifications

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="European Digital Identity" class="md-nav__button md-logo" aria-label="European Digital Identity" data-md-component="logo">
      
  <img src="../../media/eu-logo.jpg" alt="logo">

    </a>
    European Digital Identity
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/eu-digital-identity-wallet/eudi-doc-architecture-and-reference-framework" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    eu-digital-identity-wallet/eudi-doc-architecture-and-reference-framework
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    European Digital Identity Wallet
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture-and-reference-framework-main/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture and reference framework
    
      <br>
      <small>Architecture and Reference Framework</small>
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Discussion topics
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical-specifications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Technical specifications
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<p>Version 0.9, updated 17 February 2025</p>
<h1 id="b-re-issuance-and-batch-issuance-of-pids-and-attestations">B - Re-issuance and batch issuance of PIDs and Attestations</h1>
<h2 id="1-introduction">1 Introduction</h2>
<h3 id="11-discussion-paper-topic-description">1.1 Discussion Paper topic description</h3>
<p>This document is the Discussion Paper for the European Digital Identity Cooperation Group
regarding Topic B: Re-issuance and batch issuance of PIDs and
Attestations.</p>
<p>The ARF Development Plan [ARF_DevPlan] describes this Topic as
follows:</p>
<p><em>High-level requirements on re-issuance and batch issuance need to be
discussed, as this topic is currently not addressed in the ARF. For
example, requirements around authentication of the User and re-use of
existing private keys may be different for first-time issuance and
re-issuance, batch issuance or synchronous issuance of an attestation</em></p>
<h3 id="12-related-risks-in-the-risk-register">1.2 Related risks in the Risk Register</h3>
<p>The risk register for European Digital Identity Wallets [RiskRegister]
contains no risks regarding re-issuance. This is because the risk
register focuses on risks related to security and privacy, not on
operational issues such as the difference between first-time issuance
and re-issuance of attestations.</p>
<p>However, the risks mentioned in [Topic A] are related to the topic of this
document as well. This is because regular re-issuance of PIDs and attestations
can prevent Relying Party linkability risks discussed in [Topic A].</p>
<h3 id="13-key-words">1.3 Key words</h3>
<p>This document uses the capitalised key words 'SHALL', 'SHOULD' and 'MAY'
as specified in RFC 2119, i.e., to indicate requirements,
recommendations and options specified in this document.</p>
<p>In addition, 'must' (non-capitalised) is used to indicate an external
constraint, for instance a self-evident necessity or a requirement that
is mandated by an external document. The word 'can' indicates a
capability, whereas other words, such as 'will', 'is' or 'are' are
intended as statements of fact.</p>
<h3 id="14-definitions">1.4 Definitions</h3>
<p>For the purpose of this document, the following definitions apply:</p>
<ul>
<li><em>Administrative validity period of an attestation</em>: the dates from and/or up to which the attributes in the attestation are valid, which are represented as attribute(s) in the attestation.</li>
</ul>
<blockquote>
<p>Note: some attestations do not have an administrative validity period (e.g., a diploma).</p>
</blockquote>
<ul>
<li><em>Technical validity period of an attestation</em>: the dates (and possibly times) from and up to which the attestation is valid, which are represented as metadata of the attestation.</li>
</ul>
<blockquote>
<p>Note: All PIDs and attestations have a technical validity period, which is chosen based on a risk analysis, e.g. with regard to User privacy.</p>
</blockquote>
<h3 id="15-document-structure">1.5 Document structure</h3>
<p>This document is structured as follows:</p>
<ul>
<li>
<p>Chapter 2 discusses batch issuance and re-issuance of PIDs and
 attestations, as well as how these processes are supported by the
 [OpenID4VCI] specification.</p>
</li>
<li>
<p>Chapter 3 discusses some of the reasons for re-issuance.</p>
</li>
<li>
<p>Chapter 4 discusses some of the differences between first-time
 issuance and re-issuance, especially regarding User authentication
 towards PID Provider and Attestation Provider, regarding User
 authentication and key management by WSCAs, and regarding triggers
 for the re-issuance process.</p>
</li>
<li>
<p>Chapter 5 lists the additions and changes that will be made to the
 ARF as a result of discussing this topic with Member States.</p>
</li>
</ul>
<h2 id="2-re-issuance-and-batch-issuance-of-pids-and-attestations">2 Re-issuance and batch issuance of PIDs and attestations</h2>
<h3 id="21-description">2.1 Description</h3>
<p>The ARF contains a large number of requirements regarding
the issuance of PIDs and attestations, primarily in Topic 10/23 and also
in Topic 9. These requirements do not distinguish between the first time
a PID or attestation is issued and re-issuance of a PID or attestation
that is already present in a Wallet Unit. Neither do these requirements
explicitly address the topic of batch issuance.</p>
<p>Re-issuance means the replacement of a PID or attestation that already
exists in a Wallet Unit by a PID or attestation having the same document
type. Re-issuance is always performed by the same PID Provider or
Attestation Provider that issued the existing PID or attestation and it is initiated by the Wallet Unit. The
value of the attributes in the new attestation will typically be the
same as in the original attestation. However, this is not required; the
PID Provider or Attestation Provider may change one or more attribute
values. Re-issuance, as described in this document, is only applied within
the administrative validity period of a document. As an example, a mobile driving licence (mDL) is issued in the form of attestations which have a technical validity period shorter than the administrative validity period of the licence itself. Re-issuance is used for obtaining fresh attestations as needed during the administrative validity period, to ensure that the User can always share a valid mDL. However, when the administrative validity period ends, there will be a process for obtaining a new administrative driving licence. This is however out of scope of this document.</p>
<p>Batch issuance means that instead of issuing a single PID or attestation
to a Wallet Unit, a PID Provider or Attestation Provider issues a batch of them.
All PIDs or attestations in a batch have the same document type,
attribute values and validity period. In general, if the original PID or
attestation was issued in a batch, then the PID Provider or Attestation
Provider will re-issue that PID or attestation in a batch as well.</p>
<h3 id="22-support-by-openid4vci">2.2 Support by OpenID4VCI</h3>
<p>The ARF requires that Wallet Units, PID Providers, and Attestation
Providers use the [OpenID4VCI] specification for issuance of PIDs and
attestations (See requirement ISSU_01 in Annex 2). [OpenID4VCI] supports re-issuance of attestations
through so-called Refresh Tokens. These are tokens that are optionally
issued during the first-time issuance of a PID or attestation, next to
the Access Tokens used in OpenID4VCI to protect access to the PID
Provider or Attestation Provider. When the Wallet Unit needs to request
re-issuance of a PID or attestation, it must start the process by
exchanging the Refresh Token for a new Access Token.</p>
<p>Given the reasons for re-issuance discussed in the next chapter, it
seems reasonable to assume that re-issuance shall be possible for any PID
or attestation issued to a Wallet Unit.</p>
<p>The [OpenID4VCI] specification also supports batch issuance of
attestations, by optionally including multiple public keys and proofs of
possession in the proofs parameter in the Credential Request. The ARF explicitly
requires support for this functionality (ISSU_04).</p>
<p>Given the discussions in [Topic A], it seems reasonable to assume that
batch issuance is in many cases desirable. </p>
<h2 id="3-reasons-for-re-issuance">3 Reasons for re-issuance</h2>
<h3 id="31-overview">3.1 Overview</h3>
<p>There may be different reasons for re-issuing a PID or attestation, for
example:</p>
<ul>
<li>
<p>The current PID(s) or attestation(s) are near the end of their
 technical validity period, or the Wallet Unit is running out of once-only
 attestations. See section 3.2.</p>
</li>
<li>
<p>The value of one or more of the attributes in the PID or attestation
 has changed. See section 3.3.</p>
</li>
<li>
<p>The security architecture of the Wallet Solution may use PIDs and/or
 attestations that are issued just-in-time, at the moment that PID or
 attestation is being requested by a Relying Party. This is sometimes
 called synchronous issuing. See section 3.4.</p>
</li>
</ul>
<p>The main reason for batch issuance of PIDs or attestations within the
EUDI Wallet ecosystem is to (partly) mitigate Relying Party linkability.
For this, see [Topic A].</p>
<h3 id="32-pid-or-attestation-nearing-its-end-of-technical-validity-or-wallet-unit-running-out-of-pids-or-attestations">3.2 PID or attestation nearing its end of technical validity or Wallet Unit running out of PIDs or attestations</h3>
<p>As specified in [ISO/IEC 18013-5] or [SD-JWT VC], each PID or
attestation contains metadata indicating its technical validity period.
Determining the length of the technical validity period is the responsibility of
the PID Provider or the Attestation Provider; neither these standards,
nor the ARF, nor the PID Rulebook specify anything about this. The
technical validity period chosen by the PID Provider or Attestation Provider will
depend on several factors, primarily the security architecture of the
Wallet Solution and the strategy chosen to mitigate Relying Party
linkability, as discussed in [Topic A].</p>
<p>Given the above factors, it can generally be assumed that the technical validity
period of a PID or attestations will be much shorter than the lifetime of the corresponding document,
meaning the period of time that a User wants to keep that PID or
attestation in their Wallet Unit. That implies that new PIDs and
attestations will need to be issued periodically, to replace the ones
that are reaching their end of technical validity.</p>
<p>A similar reason for re-issuing PIDs and attestations occurs when the
PID Provider or Attestation Provider uses once-only attestations (as
defined in [Topic A]), which can be presented only once to a Relying
Party. In that case, the Wallet Unit, or rather the User, will regularly need new PIDs or
attestations to avoid running out.</p>
<p>Re-issuance of PIDs or attestations for these reasons is a purely
technical matter. To the maximum extent possible, the User should not
notice that a PID or attestation has been re-issued, nor should they
have to take any action to ensure that re-issuance happens in time.
Nevertheless, re-issuance events should be logged as stated in DASH_02, and
a User should be able to access this log (DASH_02b). Additionally a Wallet Unit
may offer the user the option to receive a notification of re-issuance.</p>
<p>These conditions are very different from a first-time issuance of a PID
or attestation, where the User must take the initiative to request the
PID or attestation, and is potentially involved in the process in other
ways as well. These aspects are discussed in chapter 4.</p>
<h3 id="33-a-change-in-attribute-values">3.3 A change in attribute values</h3>
<p>During the lifetime of a PID or attestation, the value of some of the
attributes may change. For example, at the date of birth of the User, an
age attestation attribute (i.e., an attribute indicating whether the
User has reached a certain age) may have to be changed from value False
to value True. In another example, the User of a mobile driving licence
may have passed the examination for a different vehicle category. In this case, the PID Provider or Attestation Provider shall re-issue the PID or attestation with the correct attribute values, and shall revoke the existing attestation.</p>
<p>Re-issuance of a PID or attestation for this reason will have an impact
on the User, because they will notice that their attribute values have
been changed. In this case Users should be informed. Additionally, an Attestation
Provider may state in their terms of conditions that re-issuance of an
attestation may be used.</p>
<h3 id="34-synchronous-issuing">3.4 Synchronous issuing</h3>
<p>A third reason for re-issuing a PID or attestation is where the PID
Provider or Attestation Provider uses synchronous issuing. In such an
architecture, the Wallet Unit requests the issuance of a new PID or
attestation after it has received a request for that PID or attestation
from a Relying Party. In such an architecture, the PID or attestation is
very short-lived and is used only once.</p>
<p>Within the scope of this document, this reason for re-issuance is very
similar to the reasons discussed in section 3.2. Users should not notice
that a PID or attestation is being re-issued, nor should they have to
take any action to ensure that re-issuance happens. However, they may
be offered the option to receive notifications. Similarly, re-issuance events should be logged.</p>
<h2 id="4-differences-between-first-time-issuance-and-re-issuance-or-batch-issuance">4 Differences between first-time issuance and re-issuance or batch issuance</h2>
<h3 id="41-user-authentication-by-pid-provider-or-attestation-provider">4.1 User authentication by PID Provider or Attestation Provider</h3>
<p>In [Topic A] a high-level requirement was established that, to the
maximum extent possible, Users will not be involved in managing the
re-issuance of new attestations. This is an important principle.
Requiring that the User is involved in re-issuance processes would mean
that a User is requested to perform actions that they did not initiate,
and for which they probably don't understand the reason. This would lead
at least to a bad user experience, and most likely also to operational
problems, such as Users not cooperating. Users may start to distrust
their Wallet Unit if it unexpectedly keeps asking the User to
authenticate, or if they are not able to present their PIDs or
attestations because they (perhaps unknowingly) blocked a request for
re-issuance.</p>
<p>The requirement of non-involvement of Users in re-issuance processes has
implications for PID Providers and Attestation Providers. One of these
implications is that the requirements regarding User authentication will
be different for first-time issuance and re-issuance. At least for PID
Providers, and for many Attestation Providers as well, it is required to
identify and authenticate the User during a first-time issuance process.
For PID Providers, it is even required to authenticate the User on Level
of Assurance High. However, for re-issuance process, performing User
authentication is not possible if the User must not be involved.</p>
<p>If the User is not authenticated during re-issuance process, there is a
risk that the PID Provider or Attestation Provider issue the new PID or
attestation to the wrong person. To prevent this, they will have to
implement alternative security mechanisms. One option for this is to
require that the Refresh Tokens used by [OpenID4VCI] are bound to the
same WSCA to which the existing PID or attestation is bound. This can be
done by requiring that OAuth 2.0 Demonstrating Proof of Possession
(DPoP) [RFC 9449] is used for these tokens, and that the public key in
the DPoP proof matches the public key in (one of) the PID(s) or
attestation(s) issued to the Wallet Unit previously.</p>
<p>Such a mechanism is common in managing certificate signing requests in
Public Key Infrastructures. It means that PID Providers or Attestation
Providers can be sure that the new PID or attestation will be bound to
the same WSCA, and thus to the same User, as the existing one.</p>
<p>For first-time batch issuance of PIDs or attestations, it seems
reasonable to require that the User needs to authenticate towards the
PID Provider or attestation provider only once, regardless of the size
of the batch, i.e., the number of PIDs or attestations issued
simultaneously to the Wallet Unit.</p>
<h3 id="42-user-authentication-and-key-management-by-the-wsca">4.2 User authentication and key management by the WSCA</h3>
<p>The ARF v1.5 contains a requirement (WUA_02) stating that "a WSCA SHALL authenticate the User before
performing any cryptographic operation involving a private or secret key
of (...) a PID or an attestation in a Wallet Unit."</p>
<p>If Users must not be aware of re-issuance processes for their existing
PIDs and attestations, this requirement may be problematic. This is
because the ARF assumes that each PID or attestation is bound to a key
pair that is generated by the WSCA. Therefore, for every new PID or
attestation, the WSCA must generate a new key pair. And key pair
generation is a cryptographic operation that, per the requirement above,
requires User authentication.</p>
<p>A solution for this challenge could be sought in several directions:</p>
<ol>
<li>
<p>By changing requirement WUA_02, such that it does not apply to key
 generation operations.</p>
</li>
<li>
<p>By allowing re-use of existing key pairs, meaning that the PID
 Provider or Attestation uses the same public key in multiple PIDs or
 attestations.</p>
</li>
<li>
<p>By relying on a Hierarchical Deterministic Key (HDK) function as
 described in clause 4.4.4.2 of [ETSI 119476].
 Using a HDK function, the PID Provider or Attestation Provider only
 needs to obtain a single public key from the WSCA, along with
 non-sensitive metadata required to apply HDK. This happens during
 first-time issuance of a first PID or attestation, where the User is involved in
 the process anyway and a request to authenticate will not come unexpectedly.
 During re-issuance or (batch) issuance of associated PID or attestations,
 the PID Provider or Attestation Provider then uses this public
 key to derive unique per-attestation public keys from the received public key,
 without involvement of the Wallet Unit or the WSCA. These newly derived
 public keys are then sent to the Wallet Unit, along with non-sensitive
 metadata required to apply HDK, and the WSCA can effectively derive
 the corresponding private keys from the existing private
 key (i.e. the one generated during first-time issuance). The WSCA then
 uses these private keys as normal during a presentation of
 attributes.</p>
</li>
<li>
<p>By using WSCA to authenticate Users before using the Wallet Unit.
Requirement WUA_03 states that "A Wallet Unit SHALL authenticate the User
before performing any operation excluding cryptographic operations. The Wallet
Unit MAY rely on a WSCA to do so (...)". Therefore, the WSCA may perform
the necessary cryptographic operations immediately after authenticating the
user on the Wallet Unit behalf.</p>
</li>
</ol>
<p>Option 1 may not count as a good solution. Cryptographic key generation
by the WSCA is a sensitive operation, and it seems unwise to allow this
to happen without User authentication, if we can avoid that. Also, it is
not clear whether all types of WSCA (such a remote HSMs but also
embedded secure element) can be made to operate in such a way that they
require User authentication before signing and key agreement operations,
but not before key generation operations.</p>
<p>Option 2 entails multiple risks and should be avoided.</p>
<p>Option 3 seems promising, but Hierarchical Deterministic Keys have not
been part of the ARF before. If we want to require support from Wallet
Units and Attestation Providers for this technology, it needs to be
further investigated. High Level Requirements for this option will be
provided in a future specification.</p>
<p>Option 4 is not achievable if the WSCA/WSCD is a remote HSM and the Wallet Unit does not have internet connection. That means that a User would not be able to open their Wallet Unit in such case. However, these conditions will probably not occur very often, relatively speaking. This paper therefore recommends Wallet Providers to implement this approach.</p>
<p>Requirement WUA_02 may also be problematic for batch issuance, if it
means that User authentication is required before generation of an
individual key pair. That would mean that for a batch of 20 PIDs or
attestations, the User would be required to authenticate 20 times. This
is clearly not acceptable from a user experience point of view,
especially not since the User is not even aware of the concept of batch
issuance, nor of the reasons for it.</p>
<p>However, ARF 1.5.0 already contains the following note to requirement
WUA_02: "Many actions of the Wallet Instance, such as processing a
Relying Party request and presenting an attestation, require multiple
cryptographic operations, for example ephemeral key generation followed
by key agreement and message encryption. This requirement does not imply
that separate User authentication is necessary before each of these
operations. Rather, a successful User authentication will be valid for
all cryptographic operations necessary for a Wallet Unit action. It is
up to the Wallet Provider to determine what constitutes a 'Wallet Unit
action', finding a balance between security (more User authentications)
and User convenience (fewer User authentications). During certification
of the Wallet Solution, it will be verified that the solution provides
an adequate level of security."</p>
<p>This Discussion Paper adds the additional requirement that (first-time) batch issuance of PIDs or attestations shall require only a single User authentication</p>
<h3 id="43-triggers-for-the-issuance-process">4.3 Triggers for the issuance process</h3>
<p>The process of first-time issuance of a PID or attestation is triggered
by the User, who wants to obtain a PID or attestation and triggers the
Wallet Unit to start the process specified in [OpenID4VCI]. If we take
the requirement that Users are not involved in re-issuance processes
absolutely, trusting on the User to trigger re-issuance is not an
option. That leaves two parties that could potentially do this: the PID
Provider or Attestation Provider, or the Wallet Unit.</p>
<p>However, it is not clear how the PID Provider or Attestation Provider
can trigger the Wallet Unit to start the re-issuance processes. A Wallet
Provider will typically be able to send a push message to a Wallet Unit,
which will cause the Wallet Unit to contact the Wallet Provider's
backend to look for any updates or other actions. But PID Providers and
Attestation Providers are different from Wallet Providers, generally
speaking, and will typically not have this option.</p>
<p>Therefore, it seems better to require that the Wallet Unit triggers the
process of re-issuing a PID or attestation, for example when the
existing PID or attestation is near the end of its validity period, or
when the Wallet Unit is running out of once-only PIDs or attestations.
[Topic A] already contains the appropriate requirements.</p>
<p>A Wallet Unit shall also give the User the option to manually initiate a re-issuance process for any of the PIDs or attestations in their Wallet Unit. This may be useful, for example, if the User knows that their Wallet Unit will go offline for an extended period of time.</p>
<p>Note that these requirements do not apply when synchronous issuance is
used. In that case, the Wallet Unit triggers the re-issuance of a PID or
attestation when attributes from that PID or attestation are requested
by a Relying Party.</p>
<p>Finally, there are situations where re-issuance of a PID or attestation is necessary because of a
change in the value of one or more of the attributes. This is more
complicated, because the Wallet Unit does not have a way to know when
this happens. There basically seem to be three options:</p>
<ol>
<li>
<p>The Wallet Unit sends at regular intervals a request to the PID
 Provider or Attestation Provider, to see if an updated version of
 the PID or attestation is available.</p>
</li>
<li>
<p>The PID Provider or Attestation Provider contacts the Wallet
 Provider to trigger the Wallet Unit to request re-issuance of the
 PID or attestation.</p>
</li>
<li>
<p>The PID Provider or Attestation Provider contacts the User via an
 out-of-band communication channel to inform them that they need to
 request an update of their PID or attestation.</p>
</li>
<li>
<p>A PID Provider or Attestation Provider revokes the attestation if attribute values
 are out-of-date. Thus the Wallet Unit should monitor the revocation status
 of its PIDs and attestations and notify the User if a PID or attestation is revoked. This enable the User to trigger a re-issuance process.</p>
</li>
</ol>
<p>Option 1 has obvious drawbacks, in particular:</p>
<ul>
<li>(Potentially) millions of Wallet Units sending such information
 requests, in most cases probably for nothing.</li>
<li>Moreover, the PID Provider or Attestation Provider would have to determine
 the frequency of such requests, which is not trivial. Too low a
 frequency may mean that the User does not receive the updated
 version of their PID or attestation in time, i.e., before the new
 values become valid. Too high a frequency increases the load on the
 systems of the PID Provider or Attestation Provider unnecessarily.</li>
<li>Finally, such a request, and also the PID Provider or Attestation
 Provider endpoint to which it can be addressed, have not been
 specified yet.</li>
</ul>
<p>Note that Option 4 is probably a solution to these drawbacks.</p>
<p>Option 2 requires direct communication between the Wallet Provider and
the PID Provider or Attestation Provider. The ARF does not foresee
such communication, primarily since it means that the Wallet Provider
gets information about the PIDs and attestations present on each of
their Wallet Units. From an architecture point of view, this would
therefore be a major change. Furthermore, this option introduces
privacy risks. On the other hand, the Commission has received
feedback stating that in the long run, when the EUDI
Wallet ecosystem is successful and a PID Provider or Attestation
Provider will have millions of subscribers, the current issuance model
will be unsustainable anyway. This is because remotely issuing and
managing millions of attestations, residing on mobile devices that are
controlled by their User, requires specialised knowledge and a dedicated
infrastructure that will not be easy to deploy for many PID Providers or
Attestation Providers. If true, this would mean that these Providers
will outsource this task to the Wallet Providers. They will send the
PIDs or attestations containing the new attribute values to the Wallet
Provider, and the Wallet Provider would be responsible for delivering
these PIDs or attestations to the respective Wallet Unit in time.
Obviously, the attribute values would be encrypted, such that the Wallet
Provider cannot read them.</p>
<p>In conclusion, this option should not yet be
considered. It should be re-examined at a later stage if such an interface is needed.</p>
<p>Option 3 violates the principle that the User is not involved in the
re-issuance of PIDs or attestations. In this case, however, that is
defensible, since the User will (have to) note the changed attribute
value anyway. This approach nevertheless has some drawbacks as well:</p>
<ul>
<li>It is only usable if during the first-time issuance of the PID or
 attestation, the PID Provider or Attestation Provider captured
 contact information of the User, such as a telephone number or
 e-mail address. This may not be the case for all attestations.</li>
<li>The User may have objections to the update of their PID or
 attestation. For example, a User may have
 lost the right to drive because of medical reasons or severe traffic
 violations. Such a User may refuse to trigger the re-issuance
 process because they want to continue using their existing PID or
 attestation with the 'old' values. Obviously, the PID Provider or
 Attestation Provider can (and shall) revoke the existing PID or
 attestation.</li>
</ul>
<p>The use of this option, as long as it does not involve the Wallet Unit for
delivering such a notification, is left to PID Providers and Attestation Providers as an implementation choice.</p>
<p>Option 4 is the recommended approach. Option 4 is similar to Option 1
but it does not suffer from the absence of an appropriate PID Provider or Attestation
Provider endpoint. However, depending on the revocation reason, re-issuance
of an attestation may not succeed. Wallet Units should be able to handle this
condition.</p>
<h3 id="44-handling-existing-pids-or-attestations-after-re-issuance-of-new-ones">4.4 Handling existing PIDs or attestations after re-issuance of new ones</h3>
<p>In general, re-issuance of a PID or attestation will take place when the existing PID or attestation is still valid.
If that were not the case, there would be a time window where User does not have any valid PIDs or attestations that they can present to Relying Parties.</p>
<p>After successful re-issuance of a PID or attestation, the Wallet Unit must delete the
existing PID or attestation, meaning the one that the re-issued PID or attestation
intends to replace. This is for a simple reason: the value of some of the attributes
in the new PID or attestation may be different from the value in the existing one.
And obviously, the Wallet Unit must not present attestations containing attribute
values that the Wallet Provider no longer wants to attest to. The Wallet Unit shall ensure
that the correct attestation is replaced.</p>
<h2 id="5-additions-and-changes-to-the-arf">5 Additions and changes to the ARF</h2>
<h3 id="51-high-level-requirements-to-be-added-to-annex-2">5.1 High-Level Requirements to be added to Annex 2</h3>
<p>The following High-Level Requirements will be added to Annex 2 of the ARF.</p>
<h4 id="511-requirements-to-be-added-likely-to-topic-1023">5.1.1 Requirements to be added (likely) to Topic 10/23</h4>
<h5 id="requirement-1">Requirement 1</h5>
<p>A Wallet Unit SHALL give its User the option to manually initiate a re-issuance process for any of the PIDs or attestations in their Wallet Unit.</p>
<h5 id="requirement-2">Requirement 2</h5>
<p>After a successful re-issuance, a Wallet Unit SHALL compare the attribute values of the re-issued PID or attestation with those of the existing PID or attestation, and SHALL notify the User in case of any differences.</p>
<h5 id="requirement-3">Requirement 3</h5>
<p>The Wallet Unit SHALL gracefully handle situations in which re-issuance of a PID or attestation is refused by the PID Provider or Attestation Provider, for example by attempting a retry after an appropriate delay.</p>
<h5 id="requirement-4">Requirement 4</h5>
<p>A Wallet Provider SHALL ensure that its Wallet Solution supports PID or attestation
first-time batch issuance with a single User authentication.</p>
<h5 id="requirement-5">Requirement 5</h5>
<p>A Wallet Provider SHALL ensure that a Wallet Unit, after successful re-issuance of a PID or attestation, deletes the correct pre-existing PID or attestation, meaning the one that the re-issued PID or attestation intends to replace.</p>
<h5 id="requirement-6">Requirement 6</h5>
<p>PID Providers, Attestation Providers, and Wallet Units SHALL support the features of [OpenID4VCI] enabling the re-issuance of all PIDs and attestations.</p>
<h5 id="requirement-7">Requirement 7</h5>
<p>PID Providers, Attestation Providers, and Wallet Units SHALL support the features of [OpenID4VCI] enabling the batch issuance of all PIDs and attestations.</p>
<h5 id="requirement-8">Requirement 8</h5>
<p>The common OpenID4VCI protocol referenced in requirement ISSU_01, or an EUDI Wallet-specific extension or profile thereof, SHALL enable a PID Provider or Attestation Provider to verify that a re-issued PID or attestation is bound to the same WSCD to which the existing PID or attestation is bound. <em>Note: This can be
done, for instance, by requiring that OAuth 2.0 Demonstrating Proof of Possession
(DPoP) [RFC 9449] is used for each Refresh Tokens, and that the public key in
the DPoP proof is identical to the public key in the existing PID or
attestation issued to the Wallet Unit previously.</em></p>
<h4 id="512-requirements-to-be-added-likely-to-topic-7">5.1.2 Requirements to be added (likely) to Topic 7</h4>
<h5 id="requirement-9">Requirement 9</h5>
<p>In case a PID Provider or Attestation Provider must change an attribute in an issued PID or attestation, it SHALL revoke that PID or attestation. Subsequently, if the User's contact details are known, the PID Provider SHOULD, via an out-of-band manner, notify the User about the revocation and ask the User to request re-issuance of the attestation using their Wallet Unit.</p>
<h5 id="requirement-10">Requirement 10</h5>
<p>A Wallet Unit SHOULD regularly check the revocation status of its PIDs, attestations, and WUAs, and notify the User if a PID or attestation, or the Wallet Unit itself, is revoked.</p>
<h4 id="512-requirements-to-be-added-likely-to-topic-19">5.1.2 Requirements to be added (likely) to Topic 19</h4>
<h5 id="requirement-11">Requirement 11</h5>
<p>A Wallet Unit SHALL log issuance and re-issuance transactions as stated in requirement DASH_02. The Wallet Unit SHALL log the date and time of the transaction,the corresponding PID Provider or Attestation Provider, the attestation type requested and the outcome of the transaction (success or failure). For a re-issuance transaction, the Wallet Unit SHALL additionally log whether it was triggered by the User or by the Wallet Unit without involvement of the User.</p>
<h3 id="52-high-level-requirements-to-be-changed">5.2 High-Level Requirements to be changed</h3>
<p>WUA_03 says: "A Wallet Unit SHALL authenticate the User before performing any operation excluding cryptographic operations. The Wallet Unit MAY rely on a WSCA to do so, per WUA_02, but MAY also rely on a User authentication method implemented in the Wallet Instance." The second sentence will be changed to "The Wallet Unit SHOULD rely on a WSCA to do so, per WUA_02, but MAY rely on a User authentication method implemented in the Wallet Instance in case using a WSCA is not feasible." A note will be added to explain that a Wallet Unit using a remote HSM and being without internet connection is an example.</p>
<h3 id="53-descriptions-to-be-added-to-the-arf-main-document">5.3 Descriptions to be added to the ARF main document</h3>
<ul>
<li>A summary of the descriptions in chapter 2 will be added to section
6.6.2 of the ARF main document.</li>
<li>A summary of the descriptions in chapter 3 will be added in the description of possible states of a PID or attestation included in section 4.6.5 of the ARF main document.</li>
<li>A summary of the descriptions in chapter 4 related to batch issuance will be
added in section 6.6.2 of the ARF main document.</li>
<li>A summary of the descriptions in chapter 4 related to re-issuance will
be included in a new section that be will be
added after section 6.6.2 of the ARF main document.</li>
</ul>
<h2 id="6-references">6 References</h2>
<table>
<thead>
<tr>
<th>Reference</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>[RiskRegister]</td>
<td>Annex 1 to the Commission Implementing Regulation laying down rules for the application of Regulation (EU) No 910/2014 of the European Parliament and of the Council as regards the certification of the European Digital Identity Wallets, European Commission, October 2024, draft</td>
</tr>
<tr>
<td>[ARF_DevPlan]</td>
<td>Architecture and Reference Framework Development plan 2025, European Commission, v0.91, final draft</td>
</tr>
<tr>
<td>[ISO18013]</td>
<td>ISO/IEC 18013-5, Personal identification — ISO-compliant driving licence — Part 5: Mobile driving licence (mDL) application, First edition, 2021-09</td>
</tr>
<tr>
<td>[SD-JWT VC]</td>
<td>SD-JWT-based Verifiable Credentials (SD-JWT VC) draft-terbu-sd-jwt-vc-06, O. Terbu <em>et al.</em>, 13 November 2024, draft</td>
</tr>
<tr>
<td>[OpenID4VCI]</td>
<td>Lodderstedt, T. <em>et al.</em>, "OpenID for Verifiable Credential Issuance", OpenID Foundation. Available at: <a href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html">https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html</a></td>
</tr>
<tr>
<td>[RFC 9449]</td>
<td>OAuth 2.0 Demonstrating Proof of Possession (DPoP), D. Fett <em>et al</em>., September 2023</td>
</tr>
<tr>
<td>[Topic A]</td>
<td>Topic A: Privacy risks and mitigations - eIDAS Cooperation Group Discussion Paper</td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.path", "toc.integrate"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"alias": true, "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>