# E - Pseudonyms, including User authentication mechanism

## 1 Introduction

### 1.1 Discussion Paper Topic Description
This document is the Discussion Paper for eIDAS Coordination Group regarding Topic E: Pseudonyms, including User authentication mechanism.
The ARF Development Plan [ARF_DevPlan] describes this Topic as follows:

*High-level requirements for pseudonyms in the ARF need to be further detailed, including
specifying the use cases where pseudonyms should be applied.*

### 1.2 Key Words
This document uses the capitalized key words 'SHALL', 'SHOULD' and 'MAY' as specified in RFC 2119, i.e., to indicate requirements, recommendations and options specified in this document.
In addition, 'must' (non-capitalized) is used to indicate an external constraint, for instance a self-evident necessity or a requirement that is mandated by an external document. The word 'can' indicates a capability, whereas other words, such as 'will', 'is' or 'are' are intended as statements of fact.

### 1.3 Document Structure

## 2 Legal Requirements for Pseudonyms

There are two legal texts that impose direct requirements on the pseudonym functionality of the EUDIWs: [CIR.2024.2979] and [eiDAS 2.0].
Below we recap the respective legal requirements from these sources.

### 2.1 [eIDAS 2.0] about Pseudonyms
There are two main requirements in [eIDAS 2.0] about Pseudonyms in relation to EUDIWs:
1. EUDIWs must be able to generate pseudonyms and store them encrypted.
2. Relying parties must accept identification via pseudonyms when there are no legal requirements for identification.

Below are the actual excerpts from the law including the recitals that establishes these requirements.

**Recital (19)**

*... Reliance on the legal identity should not hinder European Digital Identity Wallet users to access services under a pseudonym, where there is no legal requirement for legal identity for authentication. ...*

**Recital (22)**

*European Digital Identity Wallets should include a functionality to generate user-chosen and managed pseudonyms, to authenticate when accessing online services.*

**Recital (57)**

*Where very large online platforms within the meaning of Article 33(1) of Regulation (EU) 2022/2065 of the European Parliament and of the Council require users to be authenticated in order to access online services, those platforms should be required to accept the use of European Digital Identity Wallets upon the voluntary request of the user. Users should be under no obligation to use a European Digital Identity Wallet to access private services and should not be restricted or hindered in their access to services on the grounds that they do not use a European Digital Identity Wallet. However, if users wish to do so, very large online platforms should accept them for that purpose, while respecting the principle of data minimisation and the right of the users to use freely chosen pseudonyms. ...*

**Recital (60)**

*Unless specific rules of Union or national law require users to identify themselves, accessing services by using a pseudonym should not be prohibited.*

**Article 5 Pseudonyms in electronic transaction**

*Without prejudice to specific rules of Union or national law requiring users to identify themselves or to the legal effect given to pseudonyms under national law, the use of pseudonyms that are chosen by the user shall not be prohibited.*

**Article 5a European Digital Identity Wallets**

*... 4.  European Digital Identity Wallets shall enable the user, in a manner that is user-friendly, transparent, and traceable by the user, to:\
...\
(b) generate pseudonyms and store them encrypted and locally within the European Digital Identity Wallet;\
...*

**Article 5b European Digital Identity Wallet-Relying Parties**

*9. ... Relying parties shall not refuse the use of pseudonyms, where the identification of the user is not required by Union or national law. ...*


Additionally, an pseudonyms are mentioned in Article 32 and Annex IV about validation of qualified electronic signatures and certificates. Note that the use of pseudonyms in this article is orthogonal to do this topic about pseudonyms used for authentication.

### 2.2 [CIR.2024.2979] about Pseudonyms
[CIR.2024.2979] specifies three main requirements for pseudonyms:
1. [WebAuthN] defines the technical specification for pseudonyms.
2. The pseudonyms generated by the wallet must be unique for each relying party.
3. The pseudonyms can be used either standalone or in combination with other attested attributes.

Below are the actual excerpts from the law including the recitals that establishes these requirements.

**Recital (14)**

*The generation of wallet-relying party specific pseudonyms should enable wallet users to authenticate themselves without providing wallet-relying parties with unnecessary information. As set out in Regulation (EU) No 910/2014, wallet users are not to be hindered from accessing services under a pseudonym, where there is no legal requirement for legal identity for authentication. Therefore, the wallets are to include a functionality to generate user-chosen and
managed pseudonyms, to authenticate when accessing online services. The implementation of the specifications set out in Annex V should enable these functionalities accordingly. Further, wallet-relying parties are not to request users to provide any data other than those indicated for the intended use of wallets in the relying party register. Wallet users should be enabled to verify the registration data of relying parties at any point in time.*

**Article 14**

*1. Wallet units shall support the generation of pseudonyms for wallet users in compliance with the technical specifications set out in Annex V.\
2. Wallet units shall support the generation, upon the request of a wallet-relying party, of a pseudonym which is specific and unique to that wallet-relying party and provide this pseudonym to the wallet-relying party, either standalone or in combination with any person identification data or electronic attribute attestation requested by that wallet-relying party.*

**Annex V:**
*TECHNICAL SPECIFICATIONS FOR PSEUDONYM GENERATION REFERRED TO IN ARTICLE 14\
\
Technical specifications:\
\
— WebAuthn – W3C Recommendation, 8 April 2021, Level 2, https://www.w3.org/TR/2021/REC-webauthn-2-20210408/.*

## 3 Use Cases
Below, we elaborate on the use cases inferred from the above legal requirements.
The distinction between the two use cases follows from Article 14 2. [CIR.2014.2979].

Both use cases are described in an online non-proximity based setting where the pseudonyms are used over the internet.

### 3.1 Use Case A: Pseudonymous Authentication

Pseudonyms can be used to authenticate a user when it is not necessary for a relying party to learn the identity of a user.

Concretely, the use-case is as follows:
1. A user registers a pseudonym at a relying party using their EUDIW.
2. The user can afterwards do a series of interactions with this relying party.
3. If the user at a later point wishes to build upon previous interactions with this relying party they should then be able to authenticate with the pseudonym used for registering. Thereby, the user "logs in" to the same account at the relying party.
The user uses their EUDIW to perform this authentication.

### 3.2 Use Case B: Presentation of Attributes with Subsequent Authentication using Pseudonyms

Similarly, to above a user wishes to create an account with an associated pseudonym that can be used for subsequent authentication at later sessions.
However, in this scenario the user would like to register attested attributes in the form of either Person Identification Data (PID), Qualified Electronically Attested Attributes (QEAAs) or Electronically Attested Attributes (EAAs) while registering.

Concretely, the use case goes as follows:
1. A user registers a pseudonym and presents PID or (Q)EAAs to a relying party using their EUDIW.
2. The user can afterwards do a series of interactions with this relying party.
3. If the user at a later point wishes to build upon previous interactions with this relying party they should then be able to authenticate with the pseudonym used for registering. Thereby, the user "logs in" to the same account at the relying party.
The user uses their EUDIW to perform this authentication.

### 3.3 Questions Related to Use Cases

Below, we list open questions that must still be clarified related to the above two use cases.

**Question 1:** Should any other use-cases be supported?

**Question 2:** For both use cases: Should both cross-device and same-device flows be supported?
I.e., registration and authentication with pseudonyms be possible both when do user initiates the interactions with the relying party with a device different from the one hosting the EUDIW.

**Question 3:** For Use Case B: What assurances must be given to the relying party?

## 4 High Level Approach to Pseudonyms
As specified in [CIR.2024.2979], [WebAuthN] defines the technical specification for pseudonyms.
The technology underlying [WebAuthN] are commonly refereed to as passkeys.

### 4.1 Introduction to Passkeys
Passkeys are to be seen as an alternative to passwords.
The idea is that a user, when registering a user account at a service generates a public-private keypair, registers the public key at the service, and can then subsequently use the private key to authenticate towards the service at later points in time.
In a bit more detail, the flow for using such passkeys follows the following blueprint.

**Registration:**
1. The user generates a public-private keypair and stores both public and private key at their secure device (referred to as an authenticator).
2. The user registers the public key at the desired service.

**Authentication:**
When a user wishes to authenticate towards a service, the service will send them a challenge consisting of a random number.
The challenge is often referred to as a *nonce*: a number only used once.
The user uses the private key stored on their secure device to sign the nonce and sends this back to the service.
The service verifies that the signature on the nonce verifies using the preregistered public key. If the signature verifies as expected, the user is considered authenticated and thereby granted access to the service.

## 5 Relation to Other Topics

### 6.1 Privacy Risks and Mitigations

### 6.2 Wallet Unit Attestations

### 6.3 Relation to Risk Register

## 7 Additions and Changes to the ARF

## 8 References

| Reference       | Description                                                                                                                                                                                                                                                                          |
|-----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [WebAuthN]      | Web Authentication: An API for accessing Public Key Credentials Level 2 W3C Recommendation, 8 April 2021, https://www.w3.org/TR/webauthn-2/                                                                                                                                          |
| [ARF_DevPlan]   | Architecture and Reference Framework Development plan 2025, European Commission, v1,0.                                                                                                                                                                                               |
| [RiskRegister]  | Annex 1 to the Commission Implementing Regulation laying down rules for the application of Regulation (EU) No 910/2014 of the European Parliament and of the Council as regards the certification of the European Digital Identity Wallets, European Commission, October 2024, draft |
| [eIDAS 2.0]     | Regulation (EU) 2024/1183 of the European Parliament and of the Council of 11 April 2024 amending Regulation (EU) No 910/2014 as regards establishing the European Digital Identity Framework                                                                                        |
| [CIR.2024.2979] | Commission Implementing Regulation (EU) 2024/2979 of 28 November 2024 laying down rules for the application of Regulation (EU) No 910/2014 of the European Parliament and of the Council as regards the integrity and core functionalities of European Digital Identity Wallets      |
